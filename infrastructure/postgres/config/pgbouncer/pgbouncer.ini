[databases]
; Core Business Database - High Priority (30 connections)
synapse_core = host=postgres-primary port=5432 dbname=synapse_core user=postgres pool_size=30 reserve_pool=5

; Analytics Database - Medium Priority (25 connections)  
synapse_analytics = host=postgres-analytics port=5432 dbname=synapse_analytics user=postgres pool_size=25 reserve_pool=3

; Revenue Intelligence Database - Standard Priority (20 connections)
synapse_revenue = host=postgres-revenue port=5432 dbname=synapse_revenue user=postgres pool_size=20 reserve_pool=2

; Read-only connections for reporting (lower priority)
synapse_core_readonly = host=postgres-standby port=5432 dbname=synapse_core user=postgres pool_size=10 reserve_pool=2

[pgbouncer]
; Connection pooling settings
pool_mode = transaction
listen_addr = 0.0.0.0
listen_port = 5432
auth_type = scram-sha-256
auth_file = /etc/pgbouncer/userlist.txt

; Connection limits
max_client_conn = 200
default_pool_size = 25
reserve_pool_timeout = 5

; Server connection settings
server_reset_query = DISCARD ALL
server_check_delay = 30
server_check_query = SELECT 1
server_lifetime = 3600
server_idle_timeout = 600
server_connect_timeout = 15
server_login_retry = 15

; Query settings
query_timeout = 30
query_wait_timeout = 120
cancel_timeout = 10
idle_timeout = 600

; TLS/SSL settings
server_tls_sslmode = prefer
client_tls_sslmode = disable

; Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
log_stats = 1
stats_period = 60

; Performance tuning
tcp_keepalive = 1
tcp_keepcnt = 3
tcp_keepidle = 600
tcp_keepintvl = 30

; Admin settings
admin_users = postgres
stats_users = postgres

; Resource limits per database
; Core Business - Mission Critical
synapse_core.pool_size = 30
synapse_core.reserve_pool = 5
synapse_core.max_db_connections = 35

; Analytics - High Volume Queries
synapse_analytics.pool_size = 25
synapse_analytics.reserve_pool = 3
synapse_analytics.max_db_connections = 28

; Revenue Intelligence - Strategic Reports
synapse_revenue.pool_size = 20
synapse_revenue.reserve_pool = 2
synapse_revenue.max_db_connections = 22

; Application-specific settings for business continuity
; Consultation pipeline gets priority access
application_name_add_host = 1

; Failover settings
server_round_robin = 1
server_check_query = SELECT 1
server_fast_close = 1