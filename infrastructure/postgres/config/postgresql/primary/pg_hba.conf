# PostgreSQL Client Authentication Configuration File
# Optimized for production security with container networking

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             all                                     trust

# IPv4 local connections:
host    all             all             127.0.0.1/32            scram-sha-256
host    all             all             ::1/128                 scram-sha-256

# Container network connections (Docker internal)
host    all             all             172.16.0.0/12           scram-sha-256
host    all             all             192.168.0.0/16          scram-sha-256

# Replication connections for standby servers
host    replication     replicator      172.16.0.0/12           scram-sha-256
host    replication     replicator      192.168.0.0/16          scram-sha-256

# Application-specific database access
# Core Business Database
host    synapse_core    postgres        172.16.0.0/12           scram-sha-256
host    synapse_core    synapse_app     172.16.0.0/12           scram-sha-256
host    synapse_core    synapse_readonly 172.16.0.0/12          scram-sha-256

# Analytics Database Access (if connecting to primary)
host    synapse_analytics postgres      172.16.0.0/12           scram-sha-256
host    synapse_analytics analytics_user 172.16.0.0/12          scram-sha-256

# Revenue Intelligence Database Access
host    synapse_revenue postgres        172.16.0.0/12           scram-sha-256
host    synapse_revenue revenue_user    172.16.0.0/12           scram-sha-256

# Monitoring and metrics collection
host    all             postgres_exporter 172.16.0.0/12         scram-sha-256

# PgBouncer connections
host    all             pgbouncer       172.16.0.0/12           scram-sha-256

# External application access (through load balancer)
# Only allow specific application users from known networks
host    synapse_core    synapse_app     10.0.0.0/8              scram-sha-256
host    synapse_core    synapse_readonly 10.0.0.0/8             scram-sha-256

# SSL connections only for external access
hostssl synapse_core    synapse_app     0.0.0.0/0               scram-sha-256
hostssl synapse_analytics analytics_user 0.0.0.0/0              scram-sha-256
hostssl synapse_revenue revenue_user    0.0.0.0/0               scram-sha-256

# Deny all other connections
host    all             all             0.0.0.0/0               reject